# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Another Anki Web is a frontend application built on top of [AnkiConnect](https://ankiweb.net/shared/info/2055492159) that extends the functionality of the Anki client. The project is a full-stack web application using React Router 7 with server-side rendering enabled.

## Tech Stack

- **Framework**: React Router 7 (v7.9.2) with SSR enabled
- **UI Library**: Radix UI Themes
- **Styling**: Tailwind CSS v4 with Vite integration
- **Runtime**: Node.js (via @react-router/node)
- **Language**: TypeScript

## Essential Commands

```bash
# Development
npm run dev              # Start development server (Vite dev mode)
npm run build          # Build for production
npm start              # Serve production build (after building)
npm run typecheck      # Run TypeScript type checking and generate types
```

## Project Structure

- **app/** - Application code
  - **routes.ts** - Route configuration using React Router's declarative API
  - **routes/** - Individual route components
  - **root.tsx** - Root layout component with error boundary and theme setup
  - **app.css** - Global styles
  - **welcome/** - Welcome component and related modules
  - **+types/** - Auto-generated TypeScript types for routes (generated by react-router typegen)

- **react-router.config.ts** - React Router configuration (SSR enabled)
- **vite.config.ts** - Vite configuration with Tailwind and React Router plugins
- **tailwind.config.ts** - Tailwind CSS configuration

## Architecture Notes

### React Router 7 Integration

This project uses React Router 7's file-based routing with a centralized route configuration in `app/routes.ts`. Routes are defined declaratively and auto-generate TypeScript types in `+types/` directories for type-safe route parameters and loaders.

### Server-Side Rendering (SSR)

SSR is enabled in `react-router.config.ts`. This means routes are rendered on the server first, then hydrated on the client.

### Theme Setup

The app uses Radix UI Themes wrapped at the root level in `app/root.tsx`. The theme panel is exposed for user preferences (accentColor: crimson, grayColor: sand).

### Route Pattern

Routes should follow the structure:
1. Export `meta()` for document head
2. Export default component for the route
3. Can include `loader()` for data fetching (server-side)
4. Use `Route.MetaArgs` and other type imports from `./+types/[routeName]`

## Development Workflow

1. **Type generation**: Run `npm run typecheck` after adding or modifying routes to update the `+types/` directory
2. **Component development**: Place new route components in `app/routes/`
3. **Styling**: Use Tailwind CSS classes; can also use Radix UI components from `@radix-ui/themes`
4. **Testing changes**: Run `npm run dev` to see live updates
5. **i18n**: lookup at `app/i18n/`; add i18n support for English, Chinese and Japanese

## Key Features

### Browser Page
- Full-featured card browser similar to Anki desktop client
- Advanced search with Anki query syntax support
- Sortable card list with selection and batch operations
- Detailed card information display
- Real-time statistics and filtering
- Batch tag management, suspend/resume, and delete operations

See: `BROWSER_FEATURES.md` and `BROWSER_QUICKSTART.md` for detailed documentation.

### AnkiConnect Integration
- Type-safe client library with full API coverage
- React hooks for convenient component integration
- Automatic CORS handling via Vite proxy

See: `app/lib/ANKICONNECT_README.md` for detailed documentation.

### CORS Solution
- Uses Vite's development server proxy to avoid CORS issues
- Automatic environment detection (browser vs. server)
- Zero configuration required - works out of the box

See: `CORS_PROXY_SETUP.md` and `VITE_PROXY_IMPLEMENTATION.md` for technical details.

## Testing

- **Proxy Test Page**: `/test-anki-proxy` - Verify AnkiConnect proxy is working
- **Browser Page**: `/browser` - Full-featured card browser
- **Type Check**: `npm run typecheck` - Verify TypeScript compilation

## Key Dependencies

- **@react-router/dev**: Development utilities and route generation
- **@react-router/node**: Server runtime for Node.js
- **@react-router/serve**: Production server
- **@radix-ui/react-icons**: Icon components
- **@tailwindcss/vite**: Tailwind CSS Vite plugin for build optimization
- **isbot**: For bot detection (likely used in SSR)
